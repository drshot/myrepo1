[DEFAULT]
ignoreip = <%= node['fail2ban']['ignoreip'] %>
findtime = <%= node['fail2ban']['findtime'] %>
bantime = <%= node['fail2ban']['bantime'] %>
maxretry = <%= node['fail2ban']['maxretry'] %>
backend = <%= node['fail2ban']['backend'] %>
destemail = <%= node['fail2ban']['email'] %>
banaction = <%= node['fail2ban']['banaction'] %>
mta = <%= node['fail2ban']['mta'] %>
protocol = <%= node['fail2ban']['protocol'] %>
chain = <%= node['fail2ban']['chain'] %>
action_ = %(banaction)s[name=%(__name__)s, port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]
action_mw = %(banaction)s[name=%(__name__)s, port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]
%(mta)s-whois[name=%(__name__)s, dest="%(destemail)s", protocol="%(protocol)s", chain="%(chain)s"]
action_mwl = %(banaction)s[name=%(__name__)s, port="%(port)s", protocol="%(protocol)s", chain="%(chain)s"]
%(mta)s-whois-lines[name=%(__name__)s, dest="%(destemail)s", logpath=%(logpath)s, chain="%(chain)s"]
action = %(<%= node['fail2ban']['action'] %>)s





<% @node['fail2ban']['services'].each do |service, param| %>
[<%= service %>]
enabled = <%= param['enabled'] %>
<% %w{ port filter logpath findtime bantime maxretry protocol banaction }.each do |key| %>
<% if param[key] %>
<%=key%> = <%= param[key] %>
<% end %>
<% end %>
<% if param['action'] %>
<% if param['action'] =~ /action_/ %>
action = %(<%= param['action'] %>)s
<% else %>
action = <%= param['action'] %>
<% end %>
<% end %>
<% end %>
